"""Check if a host is in the Google Chrome HSTS Preload list"""

import functools
import os
import typing

__version__ = "2024.10.1"
__checksum__ = "bb960bfc12e1e818a52e00b2e14501f2c55c48001952e1cf3f0dfd8d7dd8156a"
__all__ = ["in_hsts_preload"]

# fmt: off
_GTLD_INCLUDE_SUBDOMAINS = {b'amazon', b'android', b'app', b'audible', b'azure', b'bank', b'bing', b'boo', b'channel', b'chrome', b'dad', b'day', b'dev', b'eat', b'esq', b'fire', b'fly', b'foo', b'fujitsu', b'gle', b'gmail', b'google', b'hangout', b'hotmail', b'imdb', b'ing', b'insurance', b'kindle', b'meet', b'meme', b'microsoft', b'mov', b'new', b'nexus', b'office', b'page', b'phd', b'play', b'prime', b'prof', b'rsvp', b'search', b'silk', b'skype', b'windows', b'xbox', b'xn--cckwcxetd', b'xn--jlq480n2rg', b'youtube', b'zappos', b'zip'}  # noqa: E501
_JUMPTABLE = [[(0, 11), (11, 5), (16, 19), (35, 55), (90, 26), (116, 12), (128, 8), (136, 19), (155, 22), (177, 7), (184, 13), (197, 18), None, (215, 29), (244, 37), (281, 19), (300, 9), (309, 36), (345, 24), (369, 10), (379, 18), None, (397, 62), (459, 8), (467, 22), (489, 19), (508, 13), (521, 14), (535, 21), None, None, (556, 40), (596, 20), (616, 25), (641, 22), (663, 22), (685, 28), None, (713, 15), (728, 25), (753, 8), (761, 13), (774, 10), None, (784, 17), (801, 6), (807, 19), (826, 16), (842, 5), (847, 19), (866, 14), (880, 11), (891, 18), (909, 27), (936, 7), (943, 11), (954, 15), (969, 12), (981, 20), (1001, 8), (1009, 27), (1036, 46), (1082, 25), (1107, 16), (1123, 8), (1131, 5), (1136, 22), (1158, 18), None, (1176, 36), (1212, 15), (1227, 24), (1251, 11), None, (1262, 10), (1272, 23), (1295, 18), (1313, 18), None, (1331, 20), (1351, 26), (1377, 27), (1404, 28), (1432, 20), (1452, 59), (1511, 21), (1532, 14), (1546, 8), (1554, 8), (1562, 10), (1572, 13), (1585, 20), (1605, 19), None, (1624, 13), (1637, 26), (1663, 11), (1674, 4), (1678, 22), (1700, 19), (1719, 21), (1740, 14), (1754, 28), (1782, 11), (1793, 10), (1803, 12), (1815, 25), None, (1840, 19), (1859, 14), (1873, 26), (1899, 45), (1944, 15), None, (1959, 11), (1970, 30), (2000, 21), (2021, 26), (2047, 6), (2053, 6), (2059, 14), (2073, 5), (2078, 30), (2108, 23), (2131, 6), (2137, 17), (2154, 8), (2162, 12), (2174, 12), (2186, 70), (2256, 55), (2311, 12), (2323, 23), (2346, 16), (2362, 29), (2391, 9), (2400, 24), (2424, 44), (2468, 6), (2474, 41), (2515, 22), (2537, 23), (2560, 31), (2591, 20), (2611, 8), (2619, 15), (2634, 12), (2646, 32), (2678, 25), (2703, 15), None, (2718, 46), (2764, 21), (2785, 17), (2802, 18), (2820, 26), (2846, 5), (2851, 37), (2888, 39), (2927, 16), (2943, 33), (2976, 17), (2993, 23), (3016, 21), (3037, 25), (3062, 19), (3081, 14), (3095, 7), (3102, 37), None, (3139, 18), (3157, 21), (3178, 20), (3198, 17), (3215, 24), (3239, 12), (3251, 36), (3287, 35), (3322, 12), (3334, 57), (3391, 25), (3416, 32), None, (3448, 8), (3456, 25), (3481, 18), (3499, 6), (3505, 23), None, (3528, 36), (3564, 33), (3597, 14), (3611, 16), (3627, 22), None, (3649, 30), (3679, 41), (3720, 50), (3770, 15), (3785, 20), (3805, 31), (3836, 21), (3857, 32), (3889, 24), (3913, 20), (3933, 17), (3950, 52), (4002, 6), (4008, 9), (4017, 12), (4029, 18), (4047, 11), (4058, 10), (4068, 39), (4107, 42), None, (4149, 36), (4185, 17), None, (4202, 8), (4210, 8), (4218, 17), None, (4235, 25), (4260, 17), None, (4277, 21), (4298, 35), (4333, 21), (4354, 10), (4364, 48), (4412, 11), (4423, 37), (4460, 41), (4501, 19), (4520, 12), (4532, 14), (4546, 23), (4569, 29), (4598, 14), (4612, 8), (4620, 47), (4667, 52), None, None, (4719, 47), (4766, 42), None, (4808, 18), None, (4826, 15), (4841, 8), (4849, 21), (4870, 6), (4876, 29), (4905, 22)], [(4927, 8712), (13639, 8293), (21932, 8982), (30914, 8724), (39638, 8337), (47975, 8679), (56654, 9041), (65695, 8328), (74023, 8362), (82385, 8134), (90519, 8695), (99214, 7874), (107088, 8512), (115600, 9299), (124899, 8524), (133423, 9385), (142808, 9375), (152183, 8098), (160281, 8831), (169112, 7929), (177041, 8898), (185939, 8290), (194229, 8570), (202799, 9119), (211918, 8857), (220775, 8322), (229097, 9022), (238119, 9750), (247869, 8335), (256204, 8194), (264398, 9077), (273475, 8630), (282105, 8744), (290849, 8903), (299752, 8284), (308036, 9043), (317079, 8828), (325907, 9543), (335450, 9065), (344515, 8950), (353465, 9073), (362538, 7931), (370469, 8543), (379012, 8478), (387490, 8257), (395747, 8724), (404471, 8193), (412664, 9880), (422544, 8389), (430933, 8061), (438994, 8603), (447597, 8205), (455802, 8511), (464313, 8729), (473042, 8293), (481335, 8688), (490023, 8551), (498574, 8956), (507530, 8612), (516142, 7591), (523733, 7977), (531710, 8933), (540643, 8802), (549445, 9144), (558589, 9595), (568184, 8230), (576414, 8541), (584955, 9151), (594106, 9458), (603564, 8423), (611987, 7989), (619976, 8207), (628183, 7912), (636095, 9093), (645188, 8308), (653496, 8930), (662426, 8224), (670650, 9593), (680243, 8745), (688988, 8494), (697482, 8550), (706032, 7899), (713931, 8387), (722318, 8633), (730951, 8588), (739539, 9002), (748541, 9233), (757774, 8409), (766183, 7843), (774026, 8644), (782670, 9918), (792588, 8691), (801279, 8208), (809487, 8627), (818114, 8626), (826740, 8542), (835282, 8703), (843985, 7988), (851973, 8691), (860664, 7879), (868543, 8413), (876956, 8136), (885092, 8587), (893679, 8114), (901793, 8336), (910129, 9356), (919485, 8856), (928341, 9143), (937484, 8261), (945745, 8302), (954047, 9307), (963354, 8677), (972031, 7954), (979985, 8040), (988025, 8452), (996477, 8531), (1005008, 8743), (1013751, 8977), (1022728, 8687), (1031415, 8510), (1039925, 8739), (1048664, 8700), (1057364, 8233), (1065597, 8594), (1074191, 9042), (1083233, 8200), (1091433, 8482), (1099915, 9405), (1109320, 8299), (1117619, 9799), (1127418, 9582), (1137000, 8647), (1145647, 8177), (1153824, 7843), (1161667, 8180), (1169847, 9274), (1179121, 9371), (1188492, 9709), (1198201, 8912), (1207113, 9076), (1216189, 9467), (1225656, 8964), (1234620, 8587), (1243207, 8703), (1251910, 9657), (1261567, 7622), (1269189, 8793), (1277982, 8455), (1286437, 8553), (1294990, 8567), (1303557, 8581), (1312138, 8694), (1320832, 8605), (1329437, 8199), (1337636, 8268), (1345904, 8833), (1354737, 8784), (1363521, 8705), (1372226, 8215), (1380441, 8087), (1388528, 8231), (1396759, 8637), (1405396, 8734), (1414130, 8347), (1422477, 8752), (1431229, 9428), (1440657, 9629), (1450286, 8131), (1458417, 9744), (1468161, 8580), (1476741, 8571), (1485312, 8515), (1493827, 9250), (1503077, 8229), (1511306, 8276), (1519582, 8539), (1528121, 9051), (1537172, 9048), (1546220, 8271), (1554491, 7995), (1562486, 10705), (1573191, 9298), (1582489, 8059), (1590548, 8405), (1598953, 8874), (1607827, 8964), (1616791, 7920), (1624711, 9331), (1634042, 8486), (1642528, 8710), (1651238, 8588), (1659826, 8367), (1668193, 8512), (1676705, 7754), (1684459, 8571), (1693030, 7866), (1700896, 7826), (1708722, 8200), (1716922, 8478), (1725400, 9105), (1734505, 8753), (1743258, 8804), (1752062, 8995), (1761057, 7749), (1768806, 9042), (1777848, 9197), (1787045, 8124), (1795169, 8833), (1804002, 9689), (1813691, 8189), (1821880, 9482), (1831362, 8793), (1840155, 8295), (1848450, 8509), (1856959, 8752), (1865711, 8735), (1874446, 8376), (1882822, 8634), (1891456, 8455), (1899911, 9340), (1909251, 8504), (1917755, 7950), (1925705, 9104), (1934809, 8562), (1943371, 8746), (1952117, 8443), (1960560, 9509), (1970069, 9020), (1979089, 8892), (1987981, 9282), (1997263, 9319), (2006582, 8606), (2015188, 8406), (2023594, 8909), (2032503, 8416), (2040919, 9483), (2050402, 8569), (2058971, 7995), (2066966, 7880), (2074846, 9138), (2083984, 9310), (2093294, 8854), (2102148, 8804), (2110952, 8870), (2119822, 8332), (2128154, 9384), (2137538, 8840), (2146378, 8450), (2154828, 8771), (2163599, 7754), (2171353, 8598), (2179951, 8586), (2188537, 8325), (2196862, 8223), (2205085, 8456), (2213541, 8855)], [(2222396, 930), (2223326, 811), (2224137, 886), (2225023, 857), (2225880, 894), (2226774, 825), (2227599, 651), (2228250, 937), (2229187, 685), (2229872, 902), (2230774, 476), (2231250, 755), (2232005, 920), (2232925, 1013), (2233938, 847), (2234785, 753), (2235538, 1280), (2236818, 800), (2237618, 794), (2238412, 848), (2239260, 1174), (2240434, 764), (2241198, 778), (2241976, 740), (2242716, 809), (2243525, 795), (2244320, 924), (2245244, 1371), (2246615, 801), (2247416, 777), (2248193, 811), (2249004, 745), (2249749, 771), (2250520, 812), (2251332, 1030), (2252362, 1100), (2253462, 583), (2254045, 873), (2254918, 779), (2255697, 978), (2256675, 843), (2257518, 804), (2258322, 723), (2259045, 839), (2259884, 852), (2260736, 839), (2261575, 745), (2262320, 808), (2263128, 841), (2263969, 600), (2264569, 780), (2265349, 787), (2266136, 837), (2266973, 861), (2267834, 1396), (2269230, 716), (2269946, 862), (2270808, 770), (2271578, 644), (2272222, 772), (2272994, 896), (2273890, 838), (2274728, 1034), (2275762, 863), (2276625, 821), (2277446, 784), (2278230, 966), (2279196, 715), (2279911, 614), (2280525, 1063), (2281588, 888), (2282476, 738), (2283214, 450), (2283664, 828), (2284492, 431), (2284923, 804), (2285727, 656), (2286383, 972), (2287355, 901), (2288256, 631), (2288887, 910), (2289797, 831), (2290628, 956), (2291584, 777), (2292361, 996), (2293357, 925), (2294282, 758), (2295040, 620), (2295660, 918), (2296578, 944), (2297522, 1152), (2298674, 1157), (2299831, 972), (2300803, 775), (2301578, 728), (2302306, 614), (2302920, 1015), (2303935, 831), (2304766, 774), (2305540, 747), (2306287, 841), (2307128, 795), (2307923, 816), (2308739, 572), (2309311, 830), (2310141, 952), (2311093, 673), (2311766, 594), (2312360, 860), (2313220, 1025), (2314245, 853), (2315098, 1007), (2316105, 1076), (2317181, 746), (2317927, 715), (2318642, 749), (2319391, 759), (2320150, 905), (2321055, 659), (2321714, 746), (2322460, 1106), (2323566, 759), (2324325, 931), (2325256, 824), (2326080, 920), (2327000, 834), (2327834, 876), (2328710, 884), (2329594, 637), (2330231, 981), (2331212, 780), (2331992, 1013), (2333005, 758), (2333763, 704), (2334467, 666), (2335133, 913), (2336046, 933), (2336979, 724), (2337703, 642), (2338345, 888), (2339233, 838), (2340071, 716), (2340787, 748), (2341535, 677), (2342212, 801), (2343013, 659), (2343672, 842), (2344514, 669), (2345183, 848), (2346031, 729), (2346760, 843), (2347603, 655), (2348258, 825), (2349083, 926), (2350009, 1052), (2351061, 885), (2351946, 822), (2352768, 1057), (2353825, 907), (2354732, 785), (2355517, 1098), (2356615, 719), (2357334, 964), (2358298, 958), (2359256, 1097), (2360353, 1114), (2361467, 686), (2362153, 970), (2363123, 746), (2363869, 702), (2364571, 850), (2365421, 540), (2365961, 1213), (2367174, 656), (2367830, 1035), (2368865, 868), (2369733, 1032), (2370765, 821), (2371586, 645), (2372231, 757), (2372988, 2032), (2375020, 873), (2375893, 879), (2376772, 829), (2377601, 1072), (2378673, 652), (2379325, 932), (2380257, 953), (2381210, 614), (2381824, 1060), (2382884, 644), (2383528, 630), (2384158, 562), (2384720, 1169), (2385889, 802), (2386691, 754), (2387445, 758), (2388203, 713), (2388916, 982), (2389898, 964), (2390862, 894), (2391756, 852), (2392608, 911), (2393519, 742), (2394261, 702), (2394963, 717), (2395680, 748), (2396428, 1051), (2397479, 990), (2398469, 824), (2399293, 844), (2400137, 743), (2400880, 852), (2401732, 1150), (2402882, 573), (2403455, 830), (2404285, 798), (2405083, 827), (2405910, 742), (2406652, 627), (2407279, 663), (2407942, 866), (2408808, 874), (2409682, 1029), (2410711, 556), (2411267, 698), (2411965, 769), (2412734, 721), (2413455, 856), (2414311, 821), (2415132, 988), (2416120, 585), (2416705, 1081), (2417786, 697), (2418483, 748), (2419231, 824), (2420055, 909), (2420964, 618), (2421582, 920), (2422502, 970), (2423472, 840), (2424312, 528), (2424840, 906), (2425746, 697), (2426443, 973), (2427416, 576), (2427992, 806), (2428798, 926), (2429724, 740), (2430464, 951), (2431415, 2389), (2433804, 714), (2434518, 913), (2435431, 816), (2436247, 910), (2437157, 744)], [(2437901, 48), None, None, (2437949, 42), None, (2437991, 27), (2438018, 43), None, None, None, None, None, None, None, (2438061, 21), None, None, (2438082, 42), None, (2438124, 25), (2438149, 44), None, (2438193, 49), None, None, (2438242, 23), None, None, None, None, None, None, (2438265, 21), (2438286, 46), None, None, (2438332, 44), None, None, None, None, (2438376, 44), (2438420, 21), (2438441, 23), None, None, None, None, (2438464, 42), None, None, None, None, None, (2438506, 31), None, None, None, None, (2438537, 42), (2438579, 19), None, None, (2438598, 21), None, (2438619, 26), (2438645, 56), None, (2438701, 16), (2438717, 42), (2438759, 27), None, None, None, None, (2438786, 21), (2438807, 52), None, (2438859, 17), (2438876, 20), (2438896, 42), None, None, None, (2438938, 25), (2438963, 17), (2438980, 27), (2439007, 21), None, None, None, (2439028, 24), None, (2439052, 24), (2439076, 21), (2439097, 24), None, (2439121, 48), None, None, (2439169, 17), (2439186, 19), None, None, None, None, (2439205, 31), None, None, None, None, None, None, (2439236, 28), None, (2439264, 42), (2439306, 42), (2439348, 17), (2439365, 17), (2439382, 26), (2439408, 17), (2439425, 19), None, None, None, None, (2439444, 20), None, None, (2439464, 42), (2439506, 63), (2439569, 17), None, None, (2439586, 21), None, None, None, None, (2439607, 21), (2439628, 16), None, (2439644, 31), None, None, None, None, (2439675, 42), None, (2439717, 80), None, (2439797, 9), None, (2439806, 21), (2439827, 42), None, (2439869, 18), (2439887, 90), (2439977, 56), (2440033, 45), None, (2440078, 42), None, None, (2440120, 24), (2440144, 21), None, None, None, None, None, (2440165, 42), (2440207, 21), (2440228, 21), None, (2440249, 42), (2440291, 25), None, (2440316, 55), (2440371, 21), (2440392, 42), None, None, (2440434, 36), (2440470, 16), None, None, (2440486, 16), None, (2440502, 35), None, None, (2440537, 21), None, (2440558, 22), (2440580, 21), (2440601, 21), (2440622, 21), None, (2440643, 63), (2440706, 41), (2440747, 39), (2440786, 42), None, None, None, None, None, (2440828, 15), (2440843, 21), (2440864, 21), None, None, (2440885, 21), None, None, (2440906, 21), None, None, (2440927, 19), (2440946, 66), None, None, None, (2441012, 50), None, (2441062, 21), (2441083, 21), (2441104, 19), None, (2441123, 16), (2441139, 26), None, (2441165, 58), (2441223, 42), None, None, None, None, None, None, (2441265, 21), None, None, None, (2441286, 21), None, None, (2441307, 64), None, (2441371, 254), (2441625, 21), (2441646, 24), None, (2441670, 21), (2441691, 29)], [None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, (2441720, 62), None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None]]  # noqa: E501
_CRC8_TABLE = [
    0x00, 0x07, 0x0e, 0x09, 0x1c, 0x1b, 0x12, 0x15,
    0x38, 0x3f, 0x36, 0x31, 0x24, 0x23, 0x2a, 0x2d,
    0x70, 0x77, 0x7e, 0x79, 0x6c, 0x6b, 0x62, 0x65,
    0x48, 0x4f, 0x46, 0x41, 0x54, 0x53, 0x5a, 0x5d,
    0xe0, 0xe7, 0xee, 0xe9, 0xfc, 0xfb, 0xf2, 0xf5,
    0xd8, 0xdf, 0xd6, 0xd1, 0xc4, 0xc3, 0xca, 0xcd,
    0x90, 0x97, 0x9e, 0x99, 0x8c, 0x8b, 0x82, 0x85,
    0xa8, 0xaf, 0xa6, 0xa1, 0xb4, 0xb3, 0xba, 0xbd,
    0xc7, 0xc0, 0xc9, 0xce, 0xdb, 0xdc, 0xd5, 0xd2,
    0xff, 0xf8, 0xf1, 0xf6, 0xe3, 0xe4, 0xed, 0xea,
    0xb7, 0xb0, 0xb9, 0xbe, 0xab, 0xac, 0xa5, 0xa2,
    0x8f, 0x88, 0x81, 0x86, 0x93, 0x94, 0x9d, 0x9a,
    0x27, 0x20, 0x29, 0x2e, 0x3b, 0x3c, 0x35, 0x32,
    0x1f, 0x18, 0x11, 0x16, 0x03, 0x04, 0x0d, 0x0a,
    0x57, 0x50, 0x59, 0x5e, 0x4b, 0x4c, 0x45, 0x42,
    0x6f, 0x68, 0x61, 0x66, 0x73, 0x74, 0x7d, 0x7a,
    0x89, 0x8e, 0x87, 0x80, 0x95, 0x92, 0x9b, 0x9c,
    0xb1, 0xb6, 0xbf, 0xb8, 0xad, 0xaa, 0xa3, 0xa4,
    0xf9, 0xfe, 0xf7, 0xf0, 0xe5, 0xe2, 0xeb, 0xec,
    0xc1, 0xc6, 0xcf, 0xc8, 0xdd, 0xda, 0xd3, 0xd4,
    0x69, 0x6e, 0x67, 0x60, 0x75, 0x72, 0x7b, 0x7c,
    0x51, 0x56, 0x5f, 0x58, 0x4d, 0x4a, 0x43, 0x44,
    0x19, 0x1e, 0x17, 0x10, 0x05, 0x02, 0x0b, 0x0c,
    0x21, 0x26, 0x2f, 0x28, 0x3d, 0x3a, 0x33, 0x34,
    0x4e, 0x49, 0x40, 0x47, 0x52, 0x55, 0x5c, 0x5b,
    0x76, 0x71, 0x78, 0x7f, 0x6a, 0x6d, 0x64, 0x63,
    0x3e, 0x39, 0x30, 0x37, 0x22, 0x25, 0x2c, 0x2b,
    0x06, 0x01, 0x08, 0x0f, 0x1a, 0x1d, 0x14, 0x13,
    0xae, 0xa9, 0xa0, 0xa7, 0xb2, 0xb5, 0xbc, 0xbb,
    0x96, 0x91, 0x98, 0x9f, 0x8a, 0x8d, 0x84, 0x83,
    0xde, 0xd9, 0xd0, 0xd7, 0xc2, 0xc5, 0xcc, 0xcb,
    0xe6, 0xe1, 0xe8, 0xef, 0xfa, 0xfd, 0xf4, 0xf3
]
# fmt: on

_IS_LEAF = 0x80
_INCLUDE_SUBDOMAINS = 0x40


try:
    from importlib.resources import open_binary

    def open_pkg_binary(path: str) -> typing.BinaryIO:
        return open_binary("hstspreload", path)


except ImportError:

    def open_pkg_binary(path: str) -> typing.BinaryIO:
        return open(
            os.path.join(os.path.dirname(os.path.abspath(__file__)), path),
            "rb",
        )


@functools.lru_cache(maxsize=1024)
def in_hsts_preload(host: typing.AnyStr) -> bool:
    """Determines if an IDNA-encoded host is on the HSTS preload list"""

    if isinstance(host, str):
        host = host.encode("ascii")
    labels = host.lower().split(b".")

    # Fast-branch for gTLDs that are registered to preload all sub-domains.
    if labels[-1] in _GTLD_INCLUDE_SUBDOMAINS:
        return True

    with open_pkg_binary("hstspreload.bin") as f:
        for layer, label in enumerate(labels[::-1]):
            # None of our layers are greater than 5 deep.
            if layer > 4:
                return False

            # Read the jump table for the layer and label
            jump_info = _JUMPTABLE[layer][_crc8(label)]
            if jump_info is None:
                # No entry: host is not preloaded
                return False

            # Read the set of entries for that layer and label
            f.seek(jump_info[0])
            data = bytearray(jump_info[1])
            f.readinto(data)

            for is_leaf, include_subdomains, ent_label in _iter_entries(data):
                # We found a potential leaf
                if is_leaf:
                    if ent_label == host:
                        return True
                    if include_subdomains and host.endswith(b"." + ent_label):
                        return True

                # Continue traversing as we're not at a leaf.
                elif label == ent_label:
                    break
            else:
                return False
    return False


def _iter_entries(data: bytes) -> typing.Iterable[typing.Tuple[int, int, bytes]]:
    while data:
        flags = data[0]
        size = data[1]
        label = bytes(data[2 : 2 + size])
        yield (flags & _IS_LEAF, flags & _INCLUDE_SUBDOMAINS, label)
        data = data[2 + size :]


def _crc8(value: bytes) -> int:
    # CRC8 reference implementation: https://github.com/niccokunzmann/crc8
    checksum = 0x00
    for byte in value:
        checksum = _CRC8_TABLE[checksum ^ byte]
    return checksum
